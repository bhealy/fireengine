<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Firefighter Rory and his Manntastic Engine</title>
	<link rel="stylesheet" href="./styles.css">
</head>
<body>
	<!-- Camera permission splash screen -->
	<div id="cameraPrompt" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
	                                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
	                                display: flex; align-items: center; justify-content: center; z-index: 1000;">
		<div style="background: rgba(255,255,255,0.95); padding: 50px; border-radius: 20px; 
		            max-width: 600px; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
			<h1 style="color: #333; margin-bottom: 20px; font-size: 32px;">ğŸš’ Rory's Fire Brigade</h1>
			<p style="color: #555; font-size: 18px; line-height: 1.8; margin-bottom: 30px;">
				This game uses your <strong>camera</strong> to track hand movements.<br>
				Control the fire engine with simple gestures:
			</p>
			<div style="background: #f0f0f0; padding: 20px; border-radius: 10px; margin-bottom: 30px; text-align: left;">
				<p style="margin: 8px 0; font-size: 16px;">âœ‹ <strong>Open hand</strong> = Drive forward</p>
				<p style="margin: 8px 0; font-size: 16px;">âœŠ <strong>Closed fist</strong> = Stop</p>
				<p style="margin: 8px 0; font-size: 16px;">ğŸ‘ˆğŸ‘‰ <strong>Move hand left/right</strong> = Steer</p>
			</div>
		<p style="color: #666; font-size: 14px; margin-bottom: 20px;">
			ğŸ”’ Your video never leaves your browser. Privacy guaranteed.
		</p>
		
		<!-- Volume Controls -->
		<div style="background: #f8f8f8; padding: 20px; border-radius: 10px; margin-bottom: 30px; text-align: left;">
			<h3 style="margin: 0 0 15px 0; color: #333; font-size: 16px;">ğŸ”Š Audio Settings</h3>
			
			<div style="margin-bottom: 15px;">
				<label for="musicVolume" style="display: block; color: #555; font-size: 14px; margin-bottom: 5px;">
					ğŸµ Background Music: <span id="musicVolumeValue">50</span>%
				</label>
				<input type="range" id="musicVolume" min="0" max="100" value="50" 
				       style="width: 100%; cursor: pointer;">
			</div>
			
			<div>
				<label for="sfxVolume" style="display: block; color: #555; font-size: 14px; margin-bottom: 5px;">
					ğŸ”” Sound Effects: <span id="sfxVolumeValue">70</span>%
				</label>
				<input type="range" id="sfxVolume" min="0" max="100" value="70" 
				       style="width: 100%; cursor: pointer;">
			</div>
		</div>
		
		<button id="startGameBtn" style="background: #ff4444; color: white; border: none; 
		                                    padding: 18px 40px; font-size: 20px; font-weight: bold; 
		                                    border-radius: 50px; cursor: pointer; 
		                                    box-shadow: 0 4px 15px rgba(255,68,68,0.4);
		                                    transition: transform 0.2s;">
			ğŸ® Start Game & Allow Camera
		</button>
		<button id="trainHandBtn" style="background: #2196F3; color: white; border: none; 
		                                    padding: 14px 28px; font-size: 16px; font-weight: bold; 
		                                    border-radius: 50px; cursor: pointer; 
		                                    box-shadow: 0 4px 15px rgba(33,150,243,0.4);
		                                    transition: transform 0.2s; margin-left: 12px;">
			ğŸ–ï¸ Train New Hand
		</button>
		<button id="instructionsBtn" style="background: #4CAF50; color: white; border: none; 
		                                    padding: 14px 28px; font-size: 16px; font-weight: bold; 
		                                    border-radius: 50px; cursor: pointer; 
		                                    box-shadow: 0 4px 15px rgba(76,175,80,0.4);
		                                    transition: transform 0.2s; margin-left: 12px;">
			ğŸ“– How to Play
		</button>
			<p id="permissionHelp" style="color: #999; font-size: 13px; margin-top: 20px; display: none;">
				<strong>Need help allowing camera?</strong><br>
				<span id="browserHelp"></span>
			</p>
		</div>
	</div>

	<!-- Hand Training Overlay -->
	<div id="handTrainingOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
	                                     background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; 
	                                     z-index: 1100;">
		<div style="background: rgba(255,255,255,0.97); padding: 40px; border-radius: 16px; 
		            max-width: 580px; width: 90%; text-align: center; box-shadow: 0 20px 60px rgba(0,0,0,0.35);">
			<h2 style="color: #333; margin-bottom: 10px;">Hand Training</h2>
			<p id="handTrainingText" style="color: #555; font-size: 16px; margin-top: 0; margin-bottom: 16px;">
				Hold your hand in front of the camera.
			</p>
			<div style="font-size: 52px; font-weight: 700; color: #222; margin: 8px 0 12px 0;" id="handTrainingCountdown">10</div>
			<div style="height: 10px; background: #eee; border-radius: 8px; overflow: hidden; margin: 8px 0 20px 0;">
				<div id="handTrainingProgress" style="height: 100%; width: 0%; background: linear-gradient(90deg,#2196F3,#4CAF50);"></div>
			</div>
			<div style="display: flex; gap: 10px; justify-content: center;">
				<button id="handTrainingCancel" style="background: #999; color: white; border: none; 
				                                     padding: 10px 18px; font-size: 14px; font-weight: bold; 
				                                     border-radius: 8px; cursor: pointer;">
					Cancel
				</button>
			</div>
			<p style="color: #777; font-size: 12px; margin-top: 16px;">Tip: Keep your hand inside the camera view for best results.</p>
		</div>
	</div>

	<!-- Instructions Overlay -->
	<div id="instructionsOverlay" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%;
	                                     background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; 
	                                     z-index: 1100; overflow-y: auto; padding: 20px;">
		<div style="background: rgba(255,255,255,0.97); padding: 40px; border-radius: 16px; 
		            max-width: 700px; width: 90%; text-align: left; box-shadow: 0 20px 60px rgba(0,0,0,0.35);
		            max-height: 90vh; overflow-y: auto;">
			<h2 style="color: #333; margin-bottom: 20px; text-align: center;">ğŸ® How to Play Rory's Fire Brigade</h2>
			
			<div style="margin-bottom: 20px;">
				<h3 style="color: #ff4444; margin-bottom: 10px; font-size: 18px;">ğŸ¯ Objective</h3>
				<p style="color: #555; line-height: 1.6; margin: 0;">
					Drive your fire engine through the city and extinguish burning buildings using your autonomous drone. 
					Save as many buildings as possible to earn points!
				</p>
			</div>

			<div style="margin-bottom: 20px;">
				<h3 style="color: #ff4444; margin-bottom: 10px; font-size: 18px;">âœ‹ Hand Gesture Controls</h3>
				<div style="background: #f0f0f0; padding: 15px; border-radius: 8px;">
					<p style="margin: 8px 0; color: #333;"><strong>âœ‹ Open Hand</strong> â†’ Accelerate forward</p>
					<p style="margin: 8px 0; color: #333;"><strong>âœŠ Closed Fist</strong> â†’ Stop/Coast</p>
					<p style="margin: 8px 0; color: #333;"><strong>ğŸ‘ˆ Hand Left</strong> â†’ Turn left</p>
					<p style="margin: 8px 0; color: #333;"><strong>ğŸ‘‰ Hand Right</strong> â†’ Turn right</p>
					<p style="margin: 8px 0; color: #333;"><strong>ğŸš« No Hand</strong> â†’ Emergency brake</p>
				</div>
				<p style="color: #666; font-size: 14px; margin-top: 8px; font-style: italic;">
					ğŸ’¡ Tip: Keep your hand centered to drive straight. The engine automatically slows down when turning.
				</p>
			</div>

			<div style="margin-bottom: 20px;">
				<h3 style="color: #ff4444; margin-bottom: 10px; font-size: 18px;">ğŸš Drone Firefighting</h3>
				<ol style="color: #555; line-height: 1.8; padding-left: 20px;">
					<li>Drive until you reach <strong>10 mph</strong> to enable the drone</li>
					<li>When you <strong>stop near a fire</strong>, the drone automatically dispatches</li>
					<li>The drone flies to the building and hovers above it</li>
					<li>Water activates automatically - watch the fire extinguish over 5 seconds</li>
					<li>Hold your hand as <strong>open palm</strong> to cancel the firefighting mission</li>
					<li>After saving a building, it turns <strong>green with a star</strong> â­</li>
				</ol>
				<p style="color: #666; font-size: 14px; margin-top: 8px; font-style: italic;">
					ğŸ’¡ Tip: Stop in front of burning buildings to send your drone. The drone will target the closest fire ahead of you.
				</p>
			</div>

			<div style="margin-bottom: 20px;">
				<h3 style="color: #ff4444; margin-bottom: 10px; font-size: 18px;">ğŸ† Scoring</h3>
				<div style="background: #e8f5e9; padding: 15px; border-radius: 8px; margin-bottom: 8px;">
					<p style="margin: 0; color: #2e7d32;"><strong>+100 points</strong> â†’ Successfully extinguish a fire ğŸ‰</p>
				</div>
				<div style="background: #ffebee; padding: 15px; border-radius: 8px;">
					<p style="margin: 0; color: #c62828;"><strong>-50 points</strong> â†’ Building burns down completely ğŸ’”</p>
				</div>
			</div>

			<div style="margin-bottom: 20px;">
				<h3 style="color: #ff4444; margin-bottom: 10px; font-size: 18px;">âš ï¸ Important Notes</h3>
				<ul style="color: #555; line-height: 1.8; padding-left: 20px;">
					<li>Stay on roads - driving off-road slows you down significantly</li>
					<li>Watch your speedometer - siren activates above 10 mph</li>
					<li>Bounce off buildings if you hit them (drive carefully!)</li>
					<li>Buildings will burn down if you don't save them in time</li>
					<li>Click on any building to start a fire (for practice)</li>
				</ul>
			</div>

			<div style="text-align: center; margin-top: 30px;">
				<button id="instructionsClose" style="background: #4CAF50; color: white; border: none; 
				                                     padding: 14px 32px; font-size: 16px; font-weight: bold; 
				                                     border-radius: 8px; cursor: pointer;
				                                     box-shadow: 0 4px 12px rgba(76,175,80,0.4);">
					Got It! Let's Play ğŸš’
				</button>
			</div>
		</div>
	</div>

	<div id="hud">
		<div class="row">
			<div class="brand">Rory's Fire Brigade</div>
			<div class="spacer"></div>
			<div id="firesRemaining">Fires: 0</div>
			<div id="score">Score: 0</div>
			<div id="mode">Mode: Driving</div>
		</div>
		<div id="messages" aria-live="polite"></div>
		
		<!-- Analog speedometer -->
		<div id="speedometer" style="position: fixed; bottom: 180px; left: 20px; 
		                             background: rgba(0,0,0,0.9); padding: 20px; border-radius: 15px;
		                             color: white; text-align: center;
		                             border: 3px solid rgba(255,255,255,0.3); z-index: 1000;">
			<div style="font-size: 12px; color: #aaa; margin-bottom: 10px;">SPEED (MPH)</div>
			<svg width="140" height="100" viewBox="0 0 140 100" style="display: block; margin: 0 auto;">
				<!-- Gauge background arc -->
				<path d="M 20 80 A 50 50 0 0 1 120 80" fill="none" stroke="#333" stroke-width="12" stroke-linecap="round"/>
				<!-- Colored gauge segments -->
				<path d="M 20 80 A 50 50 0 0 1 50 35" fill="none" stroke="#4CAF50" stroke-width="12" stroke-linecap="round"/>
				<path d="M 50 35 A 50 50 0 0 1 90 35" fill="none" stroke="#FFC107" stroke-width="12" stroke-linecap="round"/>
				<path d="M 90 35 A 50 50 0 0 1 120 80" fill="none" stroke="#FF5722" stroke-width="12" stroke-linecap="round"/>
				<!-- Speed tick marks -->
				<text x="15" y="85" fill="#888" font-size="10">0</text>
				<text x="35" y="48" fill="#888" font-size="10">25</text>
				<text x="65" y="30" fill="#888" font-size="10">50</text>
				<text x="95" y="48" fill="#888" font-size="10">75</text>
				<text x="118" y="85" fill="#888" font-size="10">100</text>
				<!-- Needle -->
				<g id="speedNeedle" transform="rotate(-90 70 80)">
					<line x1="70" y1="80" x2="70" y2="38" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
					<circle cx="70" cy="80" r="6" fill="#fff"/>
					<circle cx="70" cy="80" r="3" fill="#000"/>
				</g>
			</svg>
			<div id="speedValue" style="font-weight: bold; font-size: 28px; margin-top: 5px;">0</div>
		</div>
		
		<!-- Hand state visual feedback -->
		<div id="handState" style="position: fixed; bottom: 20px; left: 20px; 
		                           background: rgba(0,0,0,0.8); padding: 20px; border-radius: 10px;
		                           color: white; font-size: 48px; min-width: 150px; text-align: center;
		                           border: 2px solid rgba(255,255,255,0.3); z-index: 1000;">
			<div id="handIcon">â“</div>
			<div style="font-size: 16px; margin-top: 8px; font-weight: bold;" id="handLabel">No hand</div>
		</div>
	</div>

	<!-- Render canvas -->
	<canvas id="renderCanvas" tabindex="0" aria-label="Game canvas"></canvas>

	<!-- Debug webcam preview (small, can be hidden with CSS) -->
	<video id="inputVideo" autoplay playsinline muted></video>

	<!-- Babylon.js (core + GUI + loaders) -->
	<script src="https://cdn.babylonjs.com/babylon.js"></script>
	<script src="https://cdn.babylonjs.com/loaders/babylonjs.loaders.min.js"></script>
	<script src="https://cdn.babylonjs.com/gui/babylon.gui.min.js"></script>

	<!-- MediaPipe Hands -->
	<script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>

	<!-- App -->
	<script type="module" src="./js/main.js"></script>
</body>
<!--
This game uses the webcam. Video never leaves the browser.
-->
</html>


